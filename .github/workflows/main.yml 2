# This workflow runs your DAMSParallel.java file without Maven.
# It manually downloads the Selenium JAR, compiles, and runs the code.
name: Run DAMS Parallel Java Test

# This allows you to trigger the workflow manually from the GitHub UI
on:
  workflow_dispatch:

jobs:
  build-and-run:
    # Use the latest Ubuntu runner
    runs-on: ubuntu-latest

    steps:
      # 1. Check out your repository's code
      - name: Check out code
        uses: actions/checkout@v4

      # 2. Set up Java (JDK 17)
      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'

      # 3. Set up Chrome and chromedriver
      # This action automatically finds the right driver and adds it to the PATH
      - name: Set up Chrome
        uses: browser-actions/setup-chrome@v1
        with:
          chrome-version: stable # Use the latest stable version

      # 4. Create a 'lib' directory for our JARs
      - name: Create lib directory
        run: mkdir lib

      # 5. Download Selenium Server (Standalone) JAR
      # This single JAR contains Selenium, commons-io, and all other needed dependencies.
      # We use this to avoid Maven/Gradle.
      - name: Download Selenium Server JAR
        run: |
          echo "Downloading Selenium Server 4.21.0..."
          curl -L -o lib/selenium-server.jar "https://github.com/SeleniumHQ/selenium/releases/download/selenium-4.21.0/selenium-server-4.21.0.jar"
          echo "Download complete."
          ls -lh lib/

      # 6. Compile the Java file
      # We add the downloaded JAR to the classpath (-cp)
      - name: Compile Java code
        run: |
          javac -cp "lib/selenium-server.jar" DAMSParallel.java
          echo "Compile complete."
          ls -l *.class

      # 7. Run the compiled Java class
      # The classpath must include the current directory ('.') and the JAR.
      # Note: Linux uses ':' as the classpath separator, not ';'
      - name: Run Java test
        run: |
          java -cp ".:lib/selenium-server.jar" DAMSParallel

      # 8. Upload Screenshots Artifact
      # This 'if: always()' ensures artifacts are saved even if the Java run fails
      - name: Upload screenshots artifact
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: qr-code-screenshots
          path: screenshots/
          retention-days: 7 # Keep artifacts for 7 days

      # 9. Upload HTML Report Artifact
      - name: Upload HTML report artifact
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: html-report
          path: DAMS_Parallel_Report_*.html # Use wildcard to find the report
          retention-days: 7
